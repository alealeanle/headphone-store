(()=>{"use strict";window.onload=function(){async function t(){let t=await fetch("files/products/products.json",{method:"GET"});if(t.ok){(await t.json()).headfones.filter((t=>t.id<10?t:null)).forEach((t=>{const e=t.id,i=t.url,c=t.img,n=t.title,s=t.rate,r=t.price,o=t.priceOld,a=t.labels;document.querySelectorAll(".products__item").forEach((t=>{+t.dataset.pid===e&&(a&&(t.querySelector(".item-product__label_sale").innerText=a[0].value),t.querySelector(".item-product__image").setAttribute("href",i),t.children[1].children[0].src=`img/products/${c}`,t.children[1].children[0].alt=n,t.querySelector(".item-product__title").innerText=n,t.querySelector(".item-product__rate").innerText=s,t.querySelector(".item-product__price").innerText=r+" ₽",o&&(t.querySelector(".item-product__price_old").innerText=o+" ₽"))}))}))}else alert("Ошибка")}function e(t,e,i=!0){const c=document.querySelector(".cart-header"),n=c.querySelector(".cart-header__icon"),s=n.querySelector("span"),r=document.querySelector(`[data-cart-pid="${e}"]`),o=document.querySelector(".cart-list");if(i){if(s?s.innerHTML=++s.innerHTML:n.insertAdjacentHTML("beforeend","<span>1</span>"),r){const t=r.querySelector(".cart-list__quantity span");t.innerHTML=++t.innerHTML}else{const t=document.querySelector(`[data-pid="${e}"]`),i=`\n\t\t\t<a href="" class="cart-list__image _ibg">${t.querySelector(".item-product__image").innerHTML}</a>\n\t\t\t<div class="cart-list__body">\n\t\t\t\t<a href="" class="cart-list__title">${t.querySelector(".item-product__title").innerHTML}</a>\n\t\t\t\t<div class="cart-list__quantity">Кол-во: <span>1</span></div>\n\t\t\t\t<a href="" class="cart-list__delete">Удалить</a>\n\t\t\t</div>`;o.insertAdjacentHTML("beforeend",`<li data-cart-pid="${e}" class="cart-list__item">${i}</li>`)}t.classList.remove("_hold")}else{const t=r.querySelector(".cart-list__quantity span");t.innerHTML=--t.innerHTML,parseInt(t.innerHTML)||r.remove();const e=--s.innerHTML;e?s.innerHTML=e:(s.remove(),c.classList.remove("_active"))}}document.addEventListener("load",t),t(),document.addEventListener("click",(function(t){const i=t.target;if(i.classList.contains("products__more")&&(async function(t){if(!t.classList.contains("_hold")){t.classList.add("_hold");const e="files/products/products.json";let i=await fetch(e,{method:"GET"});i.ok?(!function(t,e){const i=document.querySelector("._wired"),c=document.querySelector("._wireless");let n;e.classList.contains("btn_wired")&&(n=t.headfones.filter((t=>"wired"===t.type&&t.id>9?t:null))),e.classList.contains("btn_wireless")&&(n=t.headfones.filter((t=>"wireless"===t.type&&t.id>9?t:null))),n.forEach((t=>{const n=t.id,s=t.url,r=t.img,o=t.title,a=t.rate,l=t.price,d=t.priceOld,u=t.labels;let _=`<article data-pid="${n}" class="products__item item-product">`,p="";if(u){let t='<div class="item-product__labels">',e="</div>",i="";u.forEach((t=>{i+=`<div class="item-product__label item-product__label_${t.type}">${t.value}</div>`})),p+=t,p+=i,p+=e}let m="";m+='<div class="item-product__prices">',m+=`<div class="item-product__price">${l} ₽</div>`,d&&(m+=`<div class="item-product__price item-product__price_old">${d} ₽</div>`),m+='\n\t\t\t\t<div class="item-product__buy">\n\t\t\t\t\t<a href="" class="item-product__button btn">Купить</a>\n\t\t\t\t</div>\n\t\t\t',m+="</div>";let f="";f+='<div class="item-product__body">',f+=`\n\t\t\t\t<div class="item-product__content">\n\t\t\t\t<h5 class="item-product__title">${o}</h5>\n\t\t\t\t<div class="item-product__rate _icon-star">${a}</div>\n\t\t\t\t</div>\n\t\t\t`,f+=m,f+="</div>";let h="";h+=_,h+=p,h+=`\n\t\t\t\t<a href="${s}" class="item-product__image _ibg">\n\t\t\t\t\t<img src="img/products/${r}" alt="${o}">\n\t\t\t\t</a>\n\t\t\t`,h+=f,h+="</article>",e.classList.contains("btn_wired")&&i.insertAdjacentHTML("beforeend",h),e.classList.contains("btn_wireless")&&c.insertAdjacentHTML("beforeend",h)}))}(await i.json(),t),t.classList.remove("_hold"),t.remove()):alert("Ошибка")}}(i),t.preventDefault()),i.classList.contains("item-product__button")){const c=i.closest(".item-product").dataset.pid;!function(t,i){if(!t.classList.contains("_hold")){t.classList.add("_hold"),t.classList.add("_fly");const c=document.querySelector(".cart-header__icon"),n=document.querySelector(`[data-pid="${i}"]`).querySelector(".item-product__image"),s=n.cloneNode(!0),r=n.offsetWidth,o=n.offsetHeight,a=n.getBoundingClientRect().top,l=n.getBoundingClientRect().left;s.setAttribute("class","_flyImage _ibg"),s.style.cssText=`\n\t\t\t\tleft: ${l}px;\n\t\t\t\ttop: ${a}px;\n\t\t\t\twidth: ${r}px;\n\t\t\t\theight: ${o}px;\n\t\t\t`,document.body.append(s);const d=c.getBoundingClientRect().left,u=c.getBoundingClientRect().top;s.style.cssText=`\n\t\t\t\tleft: ${d}px;\n\t\t\t\ttop: ${u}px;\n\t\t\t\twidth: 0px;\n\t\t\t\theight: 0px;\n\t\t\t\topacity: 0;\n\t\t\t`,s.addEventListener("transitionend",(function(){t.classList.contains("_fly")&&(s.remove(),e(t,i),t.classList.remove("_fly"))}))}}(i,c),t.preventDefault()}if(i.closest(".cart-header__body")||i.classList.contains("item-product__button")||document.querySelector(".cart-header").classList.remove("_active"),i.classList.contains("cart-list__delete")){const c=i.closest(".cart-list__item").dataset.cartPid;e(i,c,!1),t.preventDefault()}})),document.addEventListener("mouseover",(function(t){t.target.classList.contains("cart-header__icon")&&document.querySelector(".cart-list").children.length>0&&document.querySelector(".cart-header").classList.add("_active")}))};const t=document.querySelector(".header");new IntersectionObserver((function(e,i){e[0].isIntersecting?t.classList.remove("_scroll"):t.classList.add("_scroll")})).observe(t),function(t){let e=new Image;e.onload=e.onerror=function(){!function(t){let e=!0===t?"webp":"no-webp";document.documentElement.classList.add(e)}(2==e.height)},e.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}()})();